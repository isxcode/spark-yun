#!/bin/bash

home_path="/Users/ispong"
#for arg in "$@"; do
#  case "$arg" in
#    --home-path=*) home_path="${arg#*=}" ;;
#    *) echo "未知参数: $arg" && exit 1 ;;
#  esac
#done
#echo 'home_path:'+${home_path}+'\n'

mkdir ${home_path}/spark-yun-agent
echo '构建文件夹'

tar -vxf ${home_path}/spark-yun-agent.tar.gz -C ${home_path}/spark-yun-agent/
echo "解压安装包"

#pid_file=${home_path}/spark-yun-agent/spark-yun-agent.pid
#if [ -e "$pid_file" ]; then
#  pid=$(cat "$pid_file")
#  if [ -n "$pid" ]; then
#    kill -9 "$pid"
#    echo "杀死旧进程"
#  fi
#fi

spark_yun_agent= ${home_path}/spark-yun-agent/lib/spark-yun-agent.jar
spark_yun_agent_log= ${home_path}/spark-yun-agent/log/spark-yun-agent.log
nohup java -jar -Xmx2048m ${spark_yun_agent} >> ${spark_yun_agent_log} 2>&1 &
echo $! > ${home_path}/spark-yun-agent/spring-yun-agent.pid
echo "启动代理服务"

rm ${home_path}/spark-yun-agent.tar.gz && rm ${home_path}/spark-yun-install
echo "安装完成"
