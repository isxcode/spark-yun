---
title: "前端独立部署"
---

## 构建Docker源码打包镜像

### 解决方案1

#### 使用已有的阿里云镜像打包

#### Amd芯片架构

```bash
docker run --rm \
  -v ${clone_path}/spark-yun:/spark-yun \
  -w /spark-yun -it registry.cn-shanghai.aliyuncs.com/isxcode/zhiqingyun-build:amd-latest \
  /bin/bash -c "source /etc/profile && gradle install clean package"
```

#### Arm芯片架构

```bash
docker run --rm \
  -v ${clone_path}/spark-yun:/spark-yun \
  -w /spark-yun -it registry.cn-shanghai.aliyuncs.com/isxcode/zhiqingyun-build:arm-latest \
  /bin/bash -c "source /etc/profile && gradle install clean package"
```

### 解决方案2

#### 构建自己的Docker源码打包镜像

> 前提：本地安装docker

```bash
# 下载代码
git clone https://github.com/isxcode/spark-yun.git

# 启动centos8容器
docker run --privileged --name centos-base -v /tmp/spark-yun:/spark-yun -it centos:8

# 设置阿里软件源
rm -rf /etc/yum.repos.d/*
curl -ssL https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo -o /etc/yum.repos.d/CentOS-Base.repo
yum clean all && yum makecache

# 安装java环境
yum install -y  wget unzip java-1.8.0-openjdk-devel java-1.8.0-openjdk nodejs

# 安装nodejs环境
npm config set registry https://registry.npmmirror.com/
npm install -g n
n 18.20.3
npm install pnpm@9.0.6 -g
pnpm config set registry https://registry.npmmirror.com/

# 安装gradle环境
wget https://isxcode.oss-cn-shanghai.aliyuncs.com/zhiqingyun/downloads/gradle-7.6.1-bin.zip -O /opt/gradle-7.6.1-bin.zip
unzip -d /opt/ /opt/gradle-7.6.1-bin.zip
echo "export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk" >> /etc/profile
echo "export GRADLE_HOME=/opt/gradle-7.6.1" >> /etc/profile
echo "export GRADLE_USER_HOME=/root/.gradle" >> /etc/profile
echo "export PATH=/root/.local/share/fnm:$PATH:$GRADLE_HOME/bin" >> /etc/profile

# 提前安装依赖
source /etc/profile
cd /spark-yun
gradle install clean package
```

#### 提交自己的打包镜像到阿里云仓库

```bash
docker commit centos-base your_name/zhiqingyun-build:20250422
docker login --username=ispong registry.cn-shanghai.aliyuncs.com
docker push your_name/zhiqingyun-build:20250422
```

#### 使用自己构建的镜像打包

> 安装包路径: spark-yun/spark-yun-dist/build/distributions/zhiqingyun.tar.gz

```bash
docker run --rm \
  -v ${clone_path}/spark-yun:/spark-yun \
  -w /spark-yun -it your_name/zhiqingyun-build:20250422 \
  /bin/bash -c "source /etc/profile && gradle install clean package"
```